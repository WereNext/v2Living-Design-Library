<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Token Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #ffffff;
      --fg: #0a0a0a;
      --muted: #f4f4f5;
      --muted-fg: #71717a;
      --border: #e4e4e7;
      --primary: #3b82f6;
      --primary-fg: #ffffff;
      --radius: 8px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0a0a0a;
        --fg: #fafafa;
        --muted: #27272a;
        --muted-fg: #a1a1aa;
        --border: #3f3f46;
      }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--fg);
      padding: 16px;
      font-size: 14px;
      line-height: 1.5;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header .system-name {
      font-size: 12px;
      color: var(--muted-fg);
      background: var(--muted);
      padding: 4px 8px;
      border-radius: 4px;
    }

    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    .tab {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: var(--muted-fg);
      cursor: pointer;
      border-radius: var(--radius) var(--radius) 0 0;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.15s;
    }

    .tab:hover {
      color: var(--fg);
      background: var(--muted);
    }

    .tab.active {
      color: var(--primary);
      background: var(--muted);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .count-badge {
      font-size: 11px;
      background: var(--muted);
      color: var(--muted-fg);
      padding: 2px 6px;
      border-radius: 10px;
    }

    /* Color Swatches */
    .color-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }

    .color-card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.15s;
    }

    .color-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .color-swatch {
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .color-info {
      padding: 8px;
      background: var(--bg);
    }

    .color-name {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .color-value {
      font-size: 10px;
      color: var(--muted-fg);
      font-family: monospace;
    }

    /* Spacing Scale */
    .spacing-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .spacing-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      background: var(--muted);
      border-radius: var(--radius);
    }

    .spacing-bar {
      height: 24px;
      background: var(--primary);
      border-radius: 4px;
      min-width: 4px;
    }

    .spacing-label {
      font-size: 12px;
      font-weight: 500;
      min-width: 40px;
    }

    .spacing-value {
      font-size: 11px;
      color: var(--muted-fg);
      font-family: monospace;
    }

    /* Typography */
    .typography-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .typography-item {
      padding: 12px;
      background: var(--muted);
      border-radius: var(--radius);
    }

    .typography-preview {
      margin-bottom: 8px;
    }

    .typography-meta {
      font-size: 11px;
      color: var(--muted-fg);
      font-family: monospace;
    }

    /* Border Radius */
    .radius-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 12px;
    }

    .radius-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      background: var(--muted);
      border-radius: var(--radius);
    }

    .radius-preview {
      width: 48px;
      height: 48px;
      background: var(--primary);
      margin-bottom: 8px;
    }

    .radius-label {
      font-size: 12px;
      font-weight: 500;
    }

    .radius-value {
      font-size: 10px;
      color: var(--muted-fg);
      font-family: monospace;
    }

    /* Shadows */
    .shadow-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
    }

    .shadow-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
    }

    .shadow-preview {
      width: 80px;
      height: 80px;
      background: var(--bg);
      border-radius: var(--radius);
      margin-bottom: 12px;
    }

    .shadow-label {
      font-size: 12px;
      font-weight: 500;
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--fg);
      color: var(--bg);
      padding: 10px 20px;
      border-radius: var(--radius);
      font-size: 13px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Loading state */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 200px;
      color: var(--muted-fg);
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--muted);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty state */
    .empty {
      text-align: center;
      padding: 40px;
      color: var(--muted-fg);
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading design tokens...</p>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script type="module">
    // MCP Apps SDK integration
    // In production, this would import from @modelcontextprotocol/ext-apps
    // For now, we'll use postMessage directly

    let tokenData = null;
    let systemName = 'Design System';

    // Listen for tool result data from the MCP host
    window.addEventListener('message', (event) => {
      if (event.data?.type === 'toolResult') {
        tokenData = event.data.result;
        systemName = event.data.systemName || 'Design System';
        renderApp();
      }
    });

    // Also check if data was passed via URL params or injected
    function init() {
      // Check for injected data (server-side rendering)
      if (window.__MCP_DATA__) {
        tokenData = window.__MCP_DATA__.tokens;
        systemName = window.__MCP_DATA__.systemName || 'Design System';
        renderApp();
        return;
      }

      // Notify parent we're ready
      window.parent?.postMessage({ type: 'appReady', app: 'token-viewer' }, '*');

      // Show demo data after 2 seconds if no data received
      setTimeout(() => {
        if (!tokenData) {
          tokenData = getDemoData();
          renderApp();
        }
      }, 2000);
    }

    function getDemoData() {
      return {
        colors: {
          'primary': '221 83% 53%',
          'primary-foreground': '210 40% 98%',
          'secondary': '210 40% 96%',
          'secondary-foreground': '222 47% 11%',
          'background': '0 0% 100%',
          'foreground': '222 84% 5%',
          'muted': '210 40% 96%',
          'muted-foreground': '215 16% 47%',
          'accent': '210 40% 96%',
          'destructive': '0 84% 60%',
          'border': '214 32% 91%',
          'ring': '221 83% 53%'
        },
        spacing: {
          'xs': '0.25rem',
          'sm': '0.5rem',
          'md': '1rem',
          'lg': '1.5rem',
          'xl': '2rem',
          '2xl': '3rem'
        },
        typography: {
          'font-sans': 'Inter, system-ui, sans-serif',
          'font-mono': 'JetBrains Mono, monospace'
        },
        borderRadius: {
          'sm': '0.25rem',
          'md': '0.375rem',
          'lg': '0.5rem',
          'xl': '0.75rem',
          'full': '9999px'
        },
        shadows: {
          'sm': '0 1px 2px 0 rgb(0 0 0 / 0.05)',
          'md': '0 4px 6px -1px rgb(0 0 0 / 0.1)',
          'lg': '0 10px 15px -3px rgb(0 0 0 / 0.1)'
        }
      };
    }

    function renderApp() {
      const app = document.getElementById('app');

      const colorCount = Object.keys(tokenData.colors || {}).length;
      const spacingCount = Object.keys(tokenData.spacing || {}).length;
      const typographyCount = Object.keys(tokenData.typography || {}).length;
      const radiusCount = Object.keys(tokenData.borderRadius || {}).length;
      const shadowCount = Object.keys(tokenData.shadows || {}).length;

      app.innerHTML = `
        <div class="header">
          <h1>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <circle cx="12" cy="12" r="6"/>
              <circle cx="12" cy="12" r="2"/>
            </svg>
            Token Viewer
          </h1>
          <span class="system-name">${systemName}</span>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="colors">Colors (${colorCount})</button>
          <button class="tab" data-tab="spacing">Spacing (${spacingCount})</button>
          <button class="tab" data-tab="typography">Typography (${typographyCount})</button>
          <button class="tab" data-tab="radius">Radius (${radiusCount})</button>
          <button class="tab" data-tab="shadows">Shadows (${shadowCount})</button>
        </div>

        <div id="colors" class="section active">
          ${renderColors(tokenData.colors)}
        </div>

        <div id="spacing" class="section">
          ${renderSpacing(tokenData.spacing)}
        </div>

        <div id="typography" class="section">
          ${renderTypography(tokenData.typography)}
        </div>

        <div id="radius" class="section">
          ${renderRadius(tokenData.borderRadius)}
        </div>

        <div id="shadows" class="section">
          ${renderShadows(tokenData.shadows)}
        </div>
      `;

      // Tab switching
      app.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          app.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          app.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab).classList.add('active');
        });
      });

      // Copy on click
      app.querySelectorAll('[data-copy]').forEach(el => {
        el.addEventListener('click', () => {
          const value = el.dataset.copy;
          navigator.clipboard.writeText(value);
          showToast(`Copied: ${value}`);

          // Notify parent about selection
          window.parent?.postMessage({
            type: 'tokenSelected',
            token: {
              name: el.dataset.name,
              value: value,
              type: el.dataset.type
            }
          }, '*');
        });
      });
    }

    function renderColors(colors) {
      if (!colors || Object.keys(colors).length === 0) {
        return '<div class="empty">No colors defined</div>';
      }

      return `
        <div class="color-grid">
          ${Object.entries(colors).map(([name, value]) => {
            const cssValue = value.startsWith('#') || value.startsWith('rgb')
              ? value
              : `hsl(${value})`;
            const textColor = getContrastColor(cssValue);

            return `
              <div class="color-card" data-copy="${value}" data-name="${name}" data-type="color">
                <div class="color-swatch" style="background: ${cssValue}; color: ${textColor}">
                  Aa
                </div>
                <div class="color-info">
                  <div class="color-name">${name}</div>
                  <div class="color-value">${value}</div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function renderSpacing(spacing) {
      if (!spacing || Object.keys(spacing).length === 0) {
        return '<div class="empty">No spacing defined</div>';
      }

      return `
        <div class="spacing-list">
          ${Object.entries(spacing).map(([name, value]) => {
            const pxValue = parseFloat(value) * (value.includes('rem') ? 16 : 1);
            return `
              <div class="spacing-item" data-copy="${value}" data-name="${name}" data-type="spacing">
                <span class="spacing-label">${name}</span>
                <div class="spacing-bar" style="width: ${Math.min(pxValue * 4, 300)}px"></div>
                <span class="spacing-value">${value}</span>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function renderTypography(typography) {
      if (!typography || Object.keys(typography).length === 0) {
        return '<div class="empty">No typography defined</div>';
      }

      return `
        <div class="typography-list">
          ${Object.entries(typography).map(([name, value]) => {
            const isFont = name.includes('font');
            return `
              <div class="typography-item" data-copy="${value}" data-name="${name}" data-type="typography">
                <div class="typography-preview" style="${isFont ? `font-family: ${value}` : `font-size: ${value}`}">
                  ${isFont ? 'The quick brown fox jumps over the lazy dog' : 'Aa'}
                </div>
                <div class="typography-meta">${name}: ${value}</div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function renderRadius(radius) {
      if (!radius || Object.keys(radius).length === 0) {
        return '<div class="empty">No border radius defined</div>';
      }

      return `
        <div class="radius-grid">
          ${Object.entries(radius).map(([name, value]) => `
            <div class="radius-item" data-copy="${value}" data-name="${name}" data-type="radius">
              <div class="radius-preview" style="border-radius: ${value}"></div>
              <div class="radius-label">${name}</div>
              <div class="radius-value">${value}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderShadows(shadows) {
      if (!shadows || Object.keys(shadows).length === 0) {
        return '<div class="empty">No shadows defined</div>';
      }

      return `
        <div class="shadow-grid">
          ${Object.entries(shadows).map(([name, value]) => `
            <div class="shadow-item" data-copy="${value}" data-name="${name}" data-type="shadow">
              <div class="shadow-preview" style="box-shadow: ${value}"></div>
              <div class="shadow-label">${name}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function getContrastColor(bgColor) {
      // Simple contrast calculation
      try {
        const temp = document.createElement('div');
        temp.style.color = bgColor;
        document.body.appendChild(temp);
        const rgb = getComputedStyle(temp).color.match(/\d+/g);
        document.body.removeChild(temp);

        if (rgb) {
          const luminance = (0.299 * rgb[0] + 0.587 * rgb[1] + 0.114 * rgb[2]) / 255;
          return luminance > 0.5 ? '#000000' : '#ffffff';
        }
      } catch (e) {}
      return '#000000';
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // Initialize
    init();
  </script>
</body>
</html>
